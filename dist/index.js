module.exports=function(e,a,t){return e.user?t():a.redirect("/")};var passport=require("passport"),LocalStrategy=require("passport-local").Strategy,db=require("../models");passport.use(new LocalStrategy({usernameField:"email"},function(e,a,t){db.User.findOne({where:{email:e}}).then(function(e){return e?e.validPassword(a)?t(null,e):t(null,!1,{message:"Incorrect password."}):t(null,!1,{message:"Incorrect email."})})})),passport.serializeUser(function(e,a){a(null,e)}),passport.deserializeUser(function(e,a){a(null,e)}),module.exports=passport;var sequelize,fs=require("fs"),path=require("path"),Sequelize=require("sequelize"),basename=path.basename(module.filename),env=process.env.NODE_ENV||"development",config=require(__dirname+"/../config/config.json")[env],db={};sequelize=config.use_env_variable?new Sequelize(process.env[config.use_env_variable]):new Sequelize(config.database,config.username,config.password,config),fs.readdirSync(__dirname).filter(function(e){return 0!==e.indexOf(".")&&e!==basename&&".js"===e.slice(-3)}).forEach(function(e){var a=sequelize.import(path.join(__dirname,e));db[a.name]=a}),Object.keys(db).forEach(function(e){db[e].associate&&db[e].associate(db)}),db.sequelize=sequelize,db.Sequelize=Sequelize,module.exports=db;var bcrypt=require("bcryptjs");module.exports=function(e,a){var t=e.define("User",{firstname:{type:a.STRING,allowNull:!1},lastname:{type:a.STRING,allowNull:!1},username:{type:a.STRING,allowNull:!0},gradyear:{type:a.INTEGER,allowNull:!1},profilepic:{type:a.STRING,allowNull:!0},githuburl:{type:a.STRING,allowNull:!1},email:{type:a.STRING,allowNull:!1,unique:!0,validate:{isEmail:!0}},password:{type:a.STRING,allowNull:!1},location:{type:a.STRING,allowNull:!0},publicrepos:{type:a.INTEGER,allowNull:!0}});return t.prototype.validPassword=function(e){return bcrypt.compareSync(e,this.password)},t.addHook("beforeCreate",function(e){e.password=bcrypt.hashSync(e.password,bcrypt.genSaltSync(10),null)}),t},$(document).ready(function(){var e=$("#login"),i=$("input#email-input"),s=$("input#password-input");e.on("click",function(e){e.preventDefault();var a,t,r={email:i.val().trim(),password:s.val().trim()};console.log(r),r.email&&r.password&&(a=r.email,t=r.password,console.log("Login User Call"),$.ajax("/api/login",{data:{email:a,password:t},method:"POST"}).then(function(e){console.log(e)}).catch(function(e){console.log(e)}),i.val(""),s.val(""))})}),$(document).ready(function(){$.get("/api/userall",function(e){console.log(e),function(e){for(var a=0;a<e.length;a++){var t=e[a].firstname,r=e[a].lastname,i=e[a].gradyear,s=e[a].username,n=$("<img>");n.attr("src",e[a].profilepic);var o=e[a].email,l=e[a].location,d=$("<div>");d.addClass("col s12 m6"),d.attr("id","div1");var p=$("<div>");p.addClass("card"),p.attr("id","card"+a);var u=$("<div>");u.addClass("card-image"),u.attr("id","imgdiv"),n.attr("id","img1"),u.append(n);var c=$("<a>");c.attr("id","fab"),c.addClass("btn-floating halfway-fab waves-effect waves-light modal-trigger"),c.attr("href","#m1"),c.data("name",t+""+r).data("github",s).data("email",o).data("location",l);var m=$("<i>");m.addClass("material-icons"),m.text("style"),c.append(m),u.append(c);var f=$("<div>");f.addClass("card-content"),f.attr("id","div3");var g=$("<span>").text(t+" "+r);g.addClass("card-title"),g.attr("id","text1"),f.append(g);var v=$("<span>").text(i);v.addClass("class-year"),g.append(v);var b=$("<div>");b.addClass("card-action");var h=$("<span>");h.text("Github: "),h.trigger("_blank"),b.append(h);var y=$("<a>");y.text(s),y.attr("href","https://github.com/"+s),h.append(y),p.append(u),p.append(f),d.append(p),p.append(b),$(".teamCards").append(d),$("#card"+a).on("click",".btn-floating",function(e){e.preventDefault(),console.log("inside modal"),console.log(this),$("#mheader").text($(this).data("name")),$("#mgithub").text("@"+$(this).data("github")),$("#email").text($(this).data("email")),$("#location").text($(this).data("location"))})}}(e)})}),$(document).ready(function(){function s(e){$("#alert .msg").text(e.responseJSON),$("#alert").fadeIn(500)}$(".sidenav").sidenav(),$("#signup").on("click",function(e){e.preventDefault();var a=$("#password-input").parsley(),t=$("#email-input").parsley();if(!$("#grad-year").parsley().isValid())return $("#error2").text("Must be a valid 4-digit year"),void $("#grad-year").addClass("invalid");if($("#error2").text(""),$("#grad-year").removeClass("invalid"),t.isValid()){if($("#error1").text(""),!a.isValid())return $("#error").text("Password must be at least 5 characters long"),void $("#password-input").addClass("invalid");$("#error").text(""),$("#password-input").removeClass("invalid");var r,i={email:$("#email-input").val().trim(),password:$("#password-input").val().trim(),firstname:$("#first_name").val().trim(),lastname:$("#last_name").val().trim(),gradyear:$("#grad-year").val().trim(),username:$("#github").val().trim()};i.email&&i.password&&(r=i,$.post("/api/signup",r).then(function(){window.location.replace("/login")}).catch(s))}else $("#error1").text("Not a valid email address")})});var db=require("../models"),passport=require("../config/passport"),axios=require("axios");module.exports=function(e){e.post("/api/login",passport.authenticate("local"),function(e,a){console.log(e.user),a.json(e.user)}),e.post("/api/signup",function(a,t){axios.get("https://api.github.com/users/"+a.body.username).then(function(e){db.User.create({firstname:a.body.firstname,lastname:a.body.lastname,username:a.body.username,gradyear:parseInt(a.body.gradyear),profilepic:e.data.avatar_url,githuburl:e.data.html_url,email:a.body.email,password:a.body.password,location:e.data.location,publicrepos:e.data.public_repos}).then(function(){t.redirect(307,"/api/login")}).catch(function(e){t.status(401).json(e)})})}),e.get("/logout",function(e,a){e.logout(),a.redirect("/")}),e.get("/api/user_data",function(e,a){e.user?db.User.findAll({where:{email:e.user.email}}).then(function(e){a.json(e),console.log(e)}):a.json({})}),e.get("/api/userall",function(e,a){db.User.findAll({}).then(function(e){a.json(e)})})};var path=require("path"),passport=require("../config/passport"),isAuthenticated=require("../config/middleware/isAuthenticated");module.exports=function(e){e.get("/",function(e,a){e.user&&a.redirect("/members"),a.sendFile(path.join(__dirname,"../public/home.html"))}),e.get("/login",isAuthenticated,function(e,a){e.user?a.redirect("/members"):a.sendFile(path.join(__dirname,"../public/login.html"))}),e.post("/login",passport.authenticate("local"),function(e,a){e.user?a.redirect("/members"):a.sendFile(path.join(__dirname,"../public/login.html"))}),e.get("/members",isAuthenticated,function(e,a){a.sendFile(path.join(__dirname,"../public/members.html"))})};var express=require("express"),session=require("express-session"),passport=require("./config/passport"),PORT=process.env.PORT||8080,db=require("./models"),app=express();app.use(express.urlencoded({extended:!0})),app.use(express.json()),app.use(express.static("public")),app.use(session({secret:"keyboard cat",resave:!0,saveUninitialized:!0})),app.use(passport.initialize()),app.use(passport.session()),require("./routes/html-routes.js")(app),require("./routes/api-routes.js")(app),db.sequelize.sync().then(function(){app.listen(PORT,function(){console.log("==> ðŸŒŽ  Listening on port %s. Visit http://localhost:%s/ in your browser.",PORT,PORT)})});